{% extends 'main/base.html' %}
{% load static %}

{% block style %}
  <link rel="stylesheet" href="{% static 'css/profiles.css' %}">
{% endblock %}

{% block content %}
<div class="container py-4">
  <div class="row mb-4">
    <div class="col-12">
      <h2 class="contact-title text-center">
        <span style="color: #FF7C34;">▸▸▸▸▸▸▸▸▸▸</span> 
        الملف الشخصي
        <span style="color: #FF7C34;">◂◂◂◂◂◂◂◂◂◂</span>
      </h2>
    </div>
  </div>


  <div class="row g-4">
    <div class="col-12 col-md-8">
      <div class="profile-flex">
        <div class="o border-blue radius mb-4">
          {% include 'profiles/partials/photo.html' %}
        </div>

        <div class="card border-orange radius mb-4">
          {% include 'profiles/partials/personal_info.html' %}
        </div>

        <div class="card border-blue radius mb-4">
          {% include 'profiles/partials/contact_info.html' %}
        </div>

        <div class="many-card border-orange radius mb-4">
          {% include 'profiles/partials/experince.html' %}
        </div>

        <div class="many-card border-blue radius mb-4">
          {% include 'profiles/partials/skills.html' %}
        </div>

        <div class="many-card border-orange radius mb-4">
          {% include 'profiles/partials/language.html' %}
        </div>

        <div class="many-card border-blue radius mb-4">
          {% include 'profiles/partials/education.html' %}
        </div>

        <div class="many-card border-orange radius mb-4">
          {% include 'profiles/partials/certification.html' %}
        </div>
      </div>
    </div>

    <div class="col-12 col-md-3">
      <div class="prog border-orange p-3 radius ">
        <h5 class="mb-3">نسبة اكتمال الملف الشخصي</h5>
        <div class="progress mb-3" dir="ltr">
          <div
            class="progress-bar progress-bar-custom-orange"
            role="progressbar"
            style="width: {{ profile.completion_percent }}%;"
            aria-valuenow="{{ profile.completion_percent }}"
            aria-valuemin="0"
            aria-valuemax="100"
          >
            {{ profile.completion_percent }}%
          </div>
        </div>
        {% if profile.missing_sections %}
          <div class="alert alert-warning">
            <strong>لإكمال ملفك يرجى:</strong>
            <ul class="mb-0">
              {% for section in profile.missing_sections %}
                <li>{{ section }}</li>
              {% endfor %}
            </ul>
          </div>
        {% endif %}
        <a
        {% if admin_view %}
          href="{% url 'profiles:export_cv_pdf_admin' profile.user.id %}"
        {% else %}
          href="{% url 'profiles:export_cv_pdf' %}"
        {% endif %}
        class="export-pdf-btn btn w-100 mt-3 d-block text-center"
      >
        تصدير الCV الى PDF
      </a>
      </div>
    </div>
  </div>
</div>
{% block script %}
<script>
document.addEventListener('DOMContentLoaded', () => {
  // toggle “many-card” add/edit
  document.querySelectorAll('.many-card:not([data-exp-id])').forEach(x => {
    const listView = x.querySelector('.many-card-view');
    const addForm  = x.querySelector('.many-card-add');
    const addBtn   = x.querySelector('.add-btn');
    const cancel   = addForm.querySelector('.cancel-btn');
    addBtn.addEventListener('click', e => {
      e.preventDefault();
      listView.style.display = 'none';
      addForm.style.display  = 'block';
    });
    cancel.addEventListener('click', e => {
      e.preventDefault();
      addForm.style.display  = 'none';
      listView.style.display = 'block';
    });
  });

  // toggle regular cards
  document.querySelectorAll('.card').forEach(card => {
    const viewBtn   = card.querySelector('.edit-btn');
    const cancelBtn = card.querySelector('.cancel-btn');
    const viewPane  = card.querySelector('.card-view');
    const editPane  = card.querySelector('.card-edit');

    if (viewBtn) {
      viewBtn.addEventListener('click', e => {
        e.preventDefault();
        viewPane.style.display = 'none';
        editPane.style.display = 'block';
      });
    }
    if (cancelBtn) {
      cancelBtn.addEventListener('click', e => {
        e.preventDefault();
        editPane.style.display = 'none';
        viewPane.style.display = 'block';
      });
    }
  });
});
</script>
{% endblock %}


    {%endblock%}